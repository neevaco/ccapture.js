function download(t,n,i){function e(e){return String(e)}var r,o=window,s="application/octet-stream",i=i||s,a=document,h=a.createElement("a"),l=o.Blob||o.MozBlob||o.WebKitBlob||e,f=o.MSBlobBuilder||o.WebKitBlobBuilder||o.BlobBuilder,u=n||"download";if("true"===String(this)&&(i=(t=[t,i])[0],t=t[1]),String(t).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/))return navigator.msSaveBlob?navigator.msSaveBlob(function(e){var e=e.split(/[:;,]/),t=e[1],n=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),i=n.length,r=0,o=new Uint8Array(i);for(;r<i;++r)o[r]=n.charCodeAt(r);return new l([o],{type:t})}(t),u):p(t);try{r=t instanceof l?t:new l([t],{type:i})}catch(e){f&&((n=new f).append([t]),r=n.getBlob(i))}function p(e,t){if("download"in h)return h.href=e,h.setAttribute("download",u),h.innerHTML="downloading...",h.style.display="none",a.body.appendChild(h),setTimeout(function(){h.click(),a.body.removeChild(h),!0===t&&setTimeout(function(){o.URL.revokeObjectURL(h.href)},250)},66),!0;var n=a.createElement("iframe");a.body.appendChild(n),t||(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),n.src=e,setTimeout(function(){a.body.removeChild(n)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(r,u);if(o.URL)p(o.URL.createObjectURL(r),!0);else{if("string"==typeof r||r.constructor===e)try{return p("data:"+i+";base64,"+o.btoa(r))}catch(e){return p("data:"+i+","+encodeURIComponent(r))}(f=new FileReader).onload=function(e){p(this.result)},f.readAsDataURL(r)}return!0}!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).GIF=e()}(function(){return function i(r,o,s){function a(n,e){if(!o[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(h)return h(n,!0);e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}t=o[n]={exports:{}};r[n][0].call(t.exports,function(e){var t=r[n][1][e];return a(t||e)},t,t.exports,i,r,o,s)}return o[n].exports}for(var h="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function h(e){return"function"==typeof e}function l(e){return"object"==typeof e&&null!==e}function f(e){return void 0===e}((t.exports=i).EventEmitter=i).prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,r,o,s,a;if((this._events||(this._events={}),"error"===e)&&(!this._events.error||l(this._events.error)&&!this._events.error.length))throw(a=arguments[1])instanceof Error?a:((s=new Error('Uncaught, unspecified "error" event. ('+a+")")).context=a,s);if(f(t=this._events[e]))return!1;if(h(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),t.apply(this,i)}else if(l(t))for(i=Array.prototype.slice.call(arguments,1),n=(o=t.slice()).length,r=0;r<n;r++)o[r].apply(this,i);return!0},i.prototype.on=i.prototype.addListener=function(e,t){if(h(t))return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,h(t.listener)?t.listener:t),this._events[e]?l(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,l(this._events[e])&&!this._events[e].warned&&(t=f(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&0<t&&this._events[e].length>t&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this;throw TypeError("listener must be a function")},i.prototype.once=function(e,t){if(!h(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},i.prototype.removeListener=function(e,t){var n,i,r,o;if(!h(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(n=this._events[e]).length,i=-1,n===t||h(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(l(n)){for(o=r;0<o--;)if(n[o]===t||n[o].listener&&n[o].listener===t){i=o;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(h(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){e=this._events&&this._events[e]?h(this._events[e])?[this._events[e]]:this._events[e].slice():[];return e},i.prototype.listenerCount=function(e){if(this._events){e=this._events[e];if(h(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(e,t,n){var i=navigator.userAgent.toLowerCase(),r=navigator.platform.toLowerCase(),o=i.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],s="ie"===o[1]&&document.documentMode,s={name:"version"===o[1]?o[3]:o[1],version:s||parseFloat("opera"===o[1]&&o[4]?o[4]:o[2]),platform:{name:i.match(/ip(?:ad|od|hone)/)?"ios":(i.match(/(?:webos|android)/)||r.match(/mac|win|linux/)||["other"])[0]}};s[s.name]=!0,s[s.name+parseInt(s.version,10)]=!0,s.platform[s.platform.name]=!0,t.exports=s},{}],3:[function(e,t,n){var a={}.hasOwnProperty,h=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},l=[].slice,f=e("events").EventEmitter,u=e("./browser.coffee"),e=function(){var r,o,e,t=s,n=f;for(e in n)a.call(n,e)&&(t[e]=n[e]);function i(){this.constructor=t}function s(e){var t,n,i;for(n in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e),r)i=r[n],null==(t=this.options)[n]&&(t[n]=i)}return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,o={delay:500,copy:!(r={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1})},s.prototype.setOption=function(e,t){if(this.options[e]=t,null!=this._canvas&&("width"===e||"height"===e))return this._canvas[e]=t},s.prototype.setOptions=function(e){var t,n,i=[];for(t in e)a.call(e,t)&&(n=e[t],i.push(this.setOption(t,n)));return i},s.prototype.addFrame=function(e,t){var n,i;for(i in null==t&&(t={}),(n={}).transparent=this.options.transparent,o)n[i]=t[i]||o[i];if(null==this.options.width&&this.setOption("width",e.width),null==this.options.height&&this.setOption("height",e.height),"undefined"!=typeof ImageData&&null!==ImageData&&e instanceof ImageData)n.data=e.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&e instanceof WebGLRenderingContext)t.copy?n.data=this.getContextData(e):n.context=e;else{if(null==e.childNodes)throw new Error("Invalid image");t.copy?n.data=this.getImageData(e):n.image=e}return this.frames.push(n)},s.prototype.render=function(){var e,t,n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var e,t,n=[];for(e=0,t=this.frames.length;0<=t?e<t:t<e;0<=t?++e:--e)n.push(null);return n}.call(this),t=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(e=0,n=t;0<=n?e<n:n<e;0<=n?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},s.prototype.abort=function(){for(var e;null!=(e=this.activeWorkers.shift());)this.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},s.prototype.spawnWorkers=function(){var t,n,i,r=Math.min(this.options.workers,this.frames.length);return function(){n=[];for(var e=t=this.freeWorkers.length;t<=r?e<r:r<e;t<=r?e++:e--)n.push(e);return n}.apply(this).forEach((i=this,function(e){var t;return i.log("spawning worker "+e),(t=new Worker(i.options.workerScript)).onmessage=function(e){return i.activeWorkers.splice(i.activeWorkers.indexOf(t),1),i.freeWorkers.push(t),i.frameFinished(e.data)},i.freeWorkers.push(t)})),r},s.prototype.frameFinished=function(e){var t,n;if(this.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,!0===this.options.globalPalette&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),2<this.frames.length))for(t=1,n=this.freeWorkers.length;1<=n?t<n:n<t;1<=n?++t:--t)this.renderNextFrame();return 0<=h.call(this.imageParts,null)?this.renderNextFrame():this.finishRendering()},s.prototype.finishRendering=function(){for(var e,t,n,i,r,o,s,a,h,l,f,u,p=0,c=this.imageParts,d=0,m=c.length;d<m;d++)p+=((t=c[d]).data.length-1)*t.pageSize+t.cursor;for(p+=t.pageSize-t.cursor,this.log("rendering finished - filesize "+Math.round(p/1e3)+"kb"),e=new Uint8Array(p),r=h=0,s=(f=this.imageParts).length;r<s;r++)for(n=o=0,a=(u=(t=f[r]).data).length;o<a;n=++o)l=u[n],e.set(l,h),n===t.data.length-1?h+=t.cursor:h+=t.pageSize;return i=new Blob([e],{type:"image/gif"}),this.emit("finished",i,e)},s.prototype.renderNextFrame=function(){var e,t;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],t=this.freeWorkers.shift(),e=this.getTask(e),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(t),t.postMessage(e)},s.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},s.prototype.getImageData=function(e){var t;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(t=this._canvas.getContext("2d")).setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(e,0,0),this.getContextData(t)},s.prototype.getTask=function(e){var t=this.frames.indexOf(e),t={index:t,last:t===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===u.name};if(null!=e.data)t.data=e.data;else if(null!=e.context)t.data=this.getContextData(e.context);else{if(null==e.image)throw new Error("Invalid frame");t.data=this.getImageData(e.image)}return t},s.prototype.log=function(){var e=1<=arguments.length?l.call(arguments,0):[];if(this.options.debug)return console.log.apply(console,e)},s}();t.exports=e},{"./browser.coffee":2,events:1}]},{},[3])(3)}),function(){"use strict";var e={function:!0,object:!0};function t(e){return e&&e.Object===Object?e:null}parseFloat,parseInt;var n,i=e[typeof exports]&&exports&&!exports.nodeType?exports:void 0,r=e[typeof module]&&module&&!module.nodeType?module:void 0,o=r&&r.exports===i?i:void 0,s=t(i&&r&&"object"==typeof global&&global),a=t(e[typeof self]&&self),h=t(e[typeof window]&&window),e=t(e[typeof this]&&this),s=s||h!==(e&&e.window)&&h||a||e||Function("return this")();"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var i=atob(this.toDataURL(t,n).split(",")[1]),r=i.length,o=new Uint8Array(r),s=0;s<r;s++)o[s]=i.charCodeAt(s);e(new Blob([o],{type:t||"image/png"}))}}),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0&&(n=Date.now(),performance.timing&&performance.timing.navigationStart&&(n=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-n});var M=window.Date.now();function l(e){var n={};function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}this.settings=e,this.on=function(e,t){n[e]=t},this.emit=function(e){e=n[e];e&&e.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=e.name||t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t(),this.extension="",this.mimeType=""}function P(e){l.call(this,e),e.quality=31-(30*e.quality/100||10),e.workers=e.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:e.workers,quality:e.quality,workerScript:e.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(e){this.settings.onProgress&&this.settings.onProgress(e)}.bind(this)),this.encoder.on("finished",function(e){var t=this.callback;t&&(this.callback=void 0,t(e))}.bind(this))}function f(e){var t,o,r,s,a,h,l,f,u,n,p=e||{},c=(new Date,[]),d=[],m=0,g=0,w=[],v=!1,i={},y=(p.framerate=p.framerate||60,p.motionBlurFrames=2*(p.motionBlurFrames||1),t=p.verbose||!1,p.display,p.step=1e3/p.framerate,p.timeLimit=p.timeLimit||0,p.frameLimit=p.frameLimit||0,p.startTime=p.startTime||0,document.createElement("div")),b=(y.style.position="absolute",y.style.left=y.style.top=0,y.style.backgroundColor="black",y.style.fontFamily="monospace",y.style.fontSize="11px",y.style.padding="5px",y.style.color="red",y.style.zIndex=1e5,p.display&&document.body.appendChild(y),document.createElement("canvas")),x=b.getContext("2d"),e=(A("Step is set to "+p.step+"ms"),{gif:P}),_=e[p.format];if(!_)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(e).join(", ");(l=new _(p)).step=h,l.on("process",O),l.on("progress",function(e){!function(e){e=i[e];e&&e.apply(null,Array.prototype.slice.call(arguments,1))}("progress",e)}),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0&&(n=Date.now(),performance.timing&&performance.timing.navigationStart&&(n=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-n});var k=window.setTimeout,L=window.setInterval,T=window.clearInterval,C=window.clearTimeout,F=window.requestAnimationFrame,D=window.Date.now,E=window.performance.now,R=window.Date.prototype.getTime,I=[];function S(){v=!1,l.stop(),A("Capturer stop"),window.setTimeout=k,window.setInterval=L,window.clearInterval=T,window.clearTimeout=C,window.requestAnimationFrame=F,window.Date.prototype.getTime=R,window.Date.now=D,window.performance.now=E}function B(e,t){k(e,0,t)}function h(){B(O)}function O(){var e,t=1e3/p.framerate,n=(m+g/p.motionBlurFrames)*t;o=r+n,s=a+n,I.forEach(function(e){e._hookedTime=n/1e3}),t=m/p.framerate,(p.frameLimit&&m>=p.frameLimit||p.timeLimit&&t>=p.timeLimit)&&(S(),W()),(e=new Date(null)).setSeconds(t),2<p.motionBlurFrames?y.textContent="CCapture "+p.format+" | "+m+" frames ("+g+" inter) | "+e.toISOString().substr(11,8):y.textContent="CCapture "+p.format+" | "+m+" frames | "+e.toISOString().substr(11,8),A("Frame: "+m+" "+g);for(var i=0;i<c.length;i++)o>=c[i].triggerTime&&(B(c[i].callback),c.splice(i,1));for(i=0;i<d.length;i++)o>=d[i].triggerTime&&(B(d[i].callback),d[i].triggerTime+=d[i].time);w.forEach(function(e){B(e,o-M)}),w=[]}function W(e){l.save(e=e||function(e){return download(e,l.filename+l.extension,l.mimeType),!1})}function A(e){t&&console.log(e)}return{start:function(){function e(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),I.push(this)),this._hookedTime+p.startTime}A("Capturer start"),r=window.Date.now(),o=r+p.startTime,a=window.performance.now(),s=a+p.startTime,window.Date.prototype.getTime=function(){return o},window.Date.now=function(){return o},window.setTimeout=function(e,t){e={callback:e,time:t,triggerTime:o+t};return c.push(e),A("Timeout set to "+e.time),e},window.clearTimeout=function(e){for(var t=0;t<c.length;t++)c[t]==e&&(c.splice(t,1),A("Timeout cleared"))},window.setInterval=function(e,t){e={callback:e,time:t,triggerTime:o+t};return d.push(e),A("Interval set to "+e.time),e},window.clearInterval=function(e){return A("clear Interval"),null},window.requestAnimationFrame=function(e){w.push(e)},window.performance.now=function(){return s};try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:e}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:e})}catch(e){A(e)}l.start(),v=!0},capture:function(e){if(v)if(2<p.motionBlurFrames){r=e,b.width===r.width&&b.height===r.height||(b.width=r.width,b.height=r.height,f=new Uint16Array(b.height*b.width*4),x.fillStyle="#0",x.fillRect(0,0,b.width,b.height));r=e;x.drawImage(r,0,0),u=x.getImageData(0,0,b.width,b.height);for(var t=0;t<f.length;t+=4)f[t]+=u.data[t],f[t+1]+=u.data[t+1],f[t+2]+=u.data[t+2];if(++g>=.5*p.motionBlurFrames){for(var n=u.data,i=0;i<f.length;i+=4)n[i]=2*f[i]/p.motionBlurFrames,n[i+1]=2*f[i+1]/p.motionBlurFrames,n[i+2]=2*f[i+2]/p.motionBlurFrames;for(x.putImageData(u,0,0),l.add(b),g=0,A("Full MB Frame! "+ ++m+" "+o),i=0;i<f.length;i+=4)f[i]=0,f[i+1]=0,f[i+2]=0;gc()}else h()}else l.add(e),A("Full Frame! "+ ++m);var r},stop:S,save:W,on:function(e,t){i[e]=t}}}l.prototype.start=function(){},l.prototype.stop=function(){},l.prototype.add=function(){},l.prototype.save=function(){},l.prototype.dispose=function(){},l.prototype.safeToProceed=function(){return!0},l.prototype.step=function(){console.log("Step not set!")},(P.prototype=Object.create(l.prototype)).add=function(e){this.sizeSet||(this.encoder.setOption("width",e.width),this.encoder.setOption("height",e.height),this.sizeSet=!0),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx.drawImage(e,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},P.prototype.save=function(e){this.callback=e,this.encoder.render()},(h||a||{}).CCapture=f,"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return f}):i&&r?(o&&((r.exports=f).CCapture=f),i.CCapture=f):s.CCapture=f}();